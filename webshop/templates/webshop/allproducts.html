{% extends "webshop/layout1.html" %}

{% block body %}
{% load static %}

    <div class="information topbar">
        <div class="filter">
            <select name="orderSection" id="orderSelection">
                <option value="bestsellers">Sorteer op populariteit</option>
                <option value="price">Sorteer op laagste prijs</option>
                <option value="-price">Sorteer op hoogste prijs</option>
                <option value="name">Sorteer op A - Z</option>
                <option value="-name">Sorteer op Z - A</option>
                <option value="-date_added">Sorteer op nieuwste</option>
                <option value="date_added">Sorteer op oudste</option>
            </select>
        </div>
        <div class="lg-header thin right">{{ name }}</div>
    </div>
    {% if empty %}
        <div class="centered">Sorry, we hebben even geen producten in deze categorie!</div>
    {% else %}
        <div class="all-products-wrapper" id="results-div">
            {% for product in products %}
                <div class="product-card">
                    {% if not product.in_stock %}
                        <div class="top-right1 centered pink-div dark-text sm-size">Sold <br> out</div>
                    {% endif %}
                    {% if product.sale %}
                        <div class="top-right2 centered pink-div dark-text lg-size">Sale!</div>
                    {% endif %}
                    <a href="{% url 'product' product.name %}">
                        {% for img in product.image.all %}
                            {% if img.first_item %}
                                <img class="md-photo product-img" src="{% static img.image.url %}">
                            {% endif %}
                        {% endfor %}
                        <div class="product-info centered thin lg-size name-price">
                            <div class="name">{{ product.name }}</div>
                            {% if product.sale %}
                                <div class="strikethrough price">{{ product.price }}</div>
                                <div class="price">{{ product.sale_price }}</div>
                            {% else %}
                                <div class="price">{{ product.price }}</div>
                            {% endif %}
                        </div>
                    </a>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <script>
        const resultsDiv = document.querySelector("#results-div")
        const productCards = document.querySelectorAll('.product-card')
        const jewelryType = resultsDiv.dataset.jewelryType
        $('select').on('change', function() {
                let passedValue = this.value;
                $.ajax({
                    type: "GET",
                    url: "/sorteer-producten",
                    data: {
                        "passedValue": passedValue, 
                        "jewelryType": jewelryType
                    },
                }).done(function(data){
                    for (const [i, product] of Object.entries(data)) {
                        let productCard = productCards[i]
                        text = ` 
                            <a href="/product/${product.name}">
                            <img src="/static/${product.image}">
                        `
                        if (!product.in_stock) {
                            text += `<div class="top-right1 centered pink-div dark-text sm-size">Sold <br> out</div>`
                        }
                        text += `
                            <div class="product-info centered thin lg-size name-price">
                                <div class="name">${product.name}</div>
                        `
                        if (product.sale) {
                            text += `
                                <div class="strikethrough price">${product.price }</div>
                                <div class="price">${product.sale_price}</div>
                            </div>
                            </a>
                            `
                        } else {
                            text += `
                                <div class="price">${product.price }</div>
                            </div>
                            </a>
                            `
                        }
                        productCard.innerHTML = text;
                    }
                });
            });
    </script>

{% endblock %}